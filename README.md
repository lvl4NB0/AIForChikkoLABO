# InsightFace Video Face Recognition Experiment

## 概要
本リポジストリは、某高校の課題研究で作成した、insightfaceを利用して動画内の人物の顔認識を行うpythonの試験的プログラムです。

## 注意点
- GPU(CUDA ToolKit/cuDNN)が利用可能な環境を推奨します。
- GPUやCUDAを検出できなければCPU実行になり、処理速度が大幅に低下することが想定されます。
- 実験用コードのため精度・安全保証はありません。
- 学習データ、動画データは本リポジストリには含まれていません
- 本リポジトリは課題研究用のため、Issueへの対応は行いません。
## 出力するもの
- 検出領域・一致率・推論結果を描画した mp4 ファイル
- 各動画ごとの詳細な処理情報を記録した csv ファイル
- 各動画ごとの処理情報の平均値を記録した txt ファイル
- 各動画の処理情報の平均値をまとめたcsvファイル
- 全動画を通した処理情報をまとめた txt ファイル
- 学習データの平均特徴量を保存した pkl ファイル

これらはすべてこのプログラムと実行ディレクトリ直下に出力されます。

## csvファイルに出力される内容
- フレーム番号
- 処理時間[ms]
- fps(推定)
- このプログラムの1コア当たりのCPU使用率
- コンピュータの総GPUメモリ使用量
- このコードのメモリ使用量
- 一致率※

## txtファイルに出力される内容
- 総フレーム数
- 処理時間[ms]
- tpf(time per frame)
- fps
- このプログラムの1コア当たりのCPU使用率
- コンピュータの総GPUメモリ使用量
- このコードのメモリ使用量
- 既知の人物が検出されたフレーム数
- 未知の人物が検出されたフレーム数
- 全フレームのうち、未知・既知を問わず人物を検出できた割合
- 全フレームのうち、既知の人物を検出できた割合
- 未知・既知を問わず人物を検出できたなかで、未知の人物を検出した割合

※一致率とはコサイン類似度simが0≦sim≦1の百分率と仮定したものです。この値は誰もが直感的に理解しやすいように作った尺度であり、コサイン類似度を正しく解釈しておらず実際の意味の一致率とは異なります。

## 指定ディレクトリ構成
```
|-train(必須)
|  |-(名前)(一つ以上必要)
|    |-(画像)
|    |-(画像)
|  |-(名前)
|    |-(画像)
|-videos(必須)
|  |-(動画ファイル)(一つ以上必要)
|-clone_AI.py(このファイル)
|-requirements.txt
```
・ファイル名やフォルダ名に全角文字やスペースを含む場合、正しく動作しない可能性があります。

## 学習データについて
各画像には顔を一人だけ写してください。

## 実行方法
・仮想環境での実行を推奨します。
```shell
pip install -r requirements.txt
python clone_AI.py
```

## 動作確認済み環境
- OS : windows 11
- Python : ver3.10
- ライブラリ : 
	- insightface : ver 0.7.3
	- onnxruntime-gpu : ver 1.16.0
	- opencv : ver 4.9.0.80
	- numpy : ver 1.26.4
	- psutil : ver 7.2.1
	- pynvml : ver 13.0.1

## 補足資料
- [顔認識閾値に関する考察](docs/threshold.md)